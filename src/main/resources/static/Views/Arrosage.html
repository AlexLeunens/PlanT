<html lang="fr">
<html xmlns:th="https://www.thymeleaf.org">

<head>
	<div th:replace="templates/header :: header"></div>
	<title>PlanT - Arrosage</title>
	<link rel="stylesheet" type="text/css" href="Views/Styles/Arrosage.css" />

	<script src="Views/Scripts/Arrosage.js"></script>

</head>

<body>

	<div class="wrapper">

		<div th:replace="templates/Sidebar :: sidebar"></div>

		<div class="col-sm-12">
			<div id="content">

				<div class="block">
					<h1>Planning de l'arrosage</h1>
				</div>

				<div class="main">
					<div class="space">
						<label><input type="checkbox" id="weekends" checked="checked"> Show weekend</label>
					</div>

					<div id="dp"></div>
				</div>

				<script>

					var dp = new DayPilot.Month("dp");
					dp.init();
					dp.eventEndSpec = "Date";

					// EVENT CREATION
					dp.onTimeRangeSelected = function (args) {
						DayPilot.Modal.prompt("Create a new event:", "Event").then(function (modal) {
							dp.clearSelection();
							if (!modal.result) {
								return;
							}
							var params = {
								start: args.start.toString(),
								end: args.end.toString(),
								text: modal.result,
								resource: args.resource
							};
							$.ajax({
								type: 'POST',
								url: '/arrosage/events/create',
								data: JSON.stringify(params),
								success: function (data) {
									dp.events.add(new DayPilot.Event(data));
									dp.message("Event created");
								},
								contentType: "application/json",
								dataType: 'json'
							});
						});
					};

					// MOVING EVENT
					dp.onEventMove = function (args) {
						var params = {
							id: args.e.id(),
							start: args.newStart.toString(),
							end: args.newEnd.toString(),
							resource: args.newResource
						};
						$.ajax({
							type: 'POST',
							url: '/arrosage/events/move',
							data: JSON.stringify(params),
							success: function (data) {
								dp.message("Moved");
							},
							contentType: "application/json",
							dataType: 'json'
						});
					};

					// EXPANDING EVENT
					dp.onEventResize = function (args) {
						var params = {
							id: args.e.id(),
							start: args.newStart.toString(),
							end: args.newEnd.toString(),
							resource: args.e.resource()
						};
						$.ajax({
							type: 'POST',
							url: '/arrosage/events/move',
							data: JSON.stringify(params),
							success: function (data) {
								dp.message("Resized");
							},
							contentType: "application/json",
							dataType: 'json'
						});
					};

					dp.onBeforeEventRender = function (args) {
						args.data.backColor = args.data.color;
						args.data.areas = [
							{ top: 4, right: 4, width: 12, height: 14, icon: "icon-triangle-down", visibility: "Visible", action: "ContextMenu", style: "font-size: 12px; background-color: #fff; border: 1px solid #ccc; padding: 2px 2px 0px 2px; cursor:pointer;" }
						];
					};

					// EVENT DELETE & COLOR
					dp.contextMenu = new DayPilot.Menu({
						items: [
							{
								text: "Delete",
								onClick: function (args) {
									var e = args.source;
									var params = {
										id: e.id()
									};
									$.ajax({
										type: 'POST',
										url: '/arrosage/events/delete',
										data: JSON.stringify(params),
										success: function (data) {
											dp.events.remove(e);
											dp.message("Deleted");
										},
										contentType: "application/json",
										dataType: 'json'
									});
								}
							},
							{
								text: "-"
							},
							{
								text: "Blue",
								icon: "icon icon-blue",
								color: "#a2c4c9",
								onClick: function (args) { updateColor(args.source, args.item.color); }
							},
							{
								text: "Green",
								icon: "icon icon-green",
								color: "#b6d7a8",
								onClick: function (args) { updateColor(args.source, args.item.color); }
							},
							{
								text: "Yellow",
								icon: "icon icon-yellow",
								color: "#ffe599",
								onClick: function (args) { updateColor(args.source, args.item.color); }
							},
							{
								text: "Red",
								icon: "icon icon-red",
								color: "#ea9999",
								onClick: function (args) { updateColor(args.source, args.item.color); }
							}, {
								text: "Auto",
								color: "auto",
								onClick: function (args) { updateColor(args.source, args.item.color); }
							},

						]
					});

					dp.events.load("/arrosage/events");


					function updateColor(e, color) {
						var params = {
							id: e.id(),
							color: color
						};
						$.ajax({
							type: 'POST',
							url: '/arrosage/events/setColor',
							data: JSON.stringify(params),
							success: function (data) {
								e.data.color = color;
								dp.events.update(e);
							},
							contentType: "application/json",
							dataType: 'json'
						});
					}

					$(document).ready(function () {
						$("#weekends").click(function () {
							dp.showWeekend = $("#weekends").is(":checked");
							dp.update();
						});
					});

					$('div:contains("DEMO"):not(:has(div))').css('display', 'none');

				</script>


			</div>
		</div>
</body>

</html>